<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>TYPEFAST</title>
<style>
:root{
  --bg:#0f0f0f;--text:#fff;--accent:#facc15;--accent2:#a78bfa;
  --warn:#f97316;--danger:#ef4444;--dim:#555;--surface:#1c1c1c;
  --correct:#22c55e;--key-bg:#2a2a2a;--key-text:#666
}
*{margin:0;padding:0;box-sizing:border-box}
body{min-height:100vh;background:var(--bg);color:var(--text);font-family:'Courier New',monospace;
  display:flex;flex-direction:column;align-items:center;justify-content:center;overflow:hidden}
.screen{width:100%;min-height:100vh;display:flex;flex-direction:column;
  align-items:center;justify-content:center;padding:1.5rem}
.hidden{display:none!important}
button{font-family:'Courier New',monospace;cursor:pointer}
.btn-main{background:var(--accent);color:#000;border:none;padding:.9rem 3rem;
  font-size:1.1rem;font-weight:900;letter-spacing:.12em;border-radius:4px;transition:transform .1s,opacity .1s}
.btn-main:hover{opacity:.9;transform:scale(1.03)}
.btn-sub{background:none;color:var(--dim);border:none;padding:.75rem 2rem;font-size:.9rem;margin-top:.3rem}

/* â”€â”€ MENU â”€â”€ */
#logo{font-size:3.5rem;font-weight:900;letter-spacing:.15em;color:var(--accent);text-shadow:0 0 30px rgba(250,204,21,.3)}
#tagline{color:var(--dim);margin:.4rem 0 2.5rem;font-size:.9rem;letter-spacing:.08em}
#menu-hs{color:var(--accent);font-size:.9rem;margin-bottom:1.2rem;letter-spacing:.05em;min-height:1.2rem}
.menu-info{margin-top:2.5rem;color:var(--dim);font-size:.78rem;text-align:center;line-height:2;letter-spacing:.03em}

/* â”€â”€ VOICE TOGGLE â”€â”€ */
#voice-toggle{display:flex;align-items:center;gap:.6rem;margin-bottom:1.6rem;cursor:pointer;user-select:none}
#voice-toggle input{accent-color:var(--accent);width:16px;height:16px;cursor:pointer}
#voice-toggle label{color:var(--dim);font-size:.82rem;letter-spacing:.06em;cursor:pointer}

/* â”€â”€ HUD â”€â”€ */
.hdr{position:absolute;top:1.6rem;left:0;right:0;display:flex;justify-content:space-between;
  align-items:center;padding:0 1.8rem;font-size:.82rem;color:var(--dim)}
.hv{color:var(--text);font-weight:bold;font-size:.95rem}
#hdr-streak-wrap{display:flex;align-items:center;gap:.3rem}
#fire-icons{letter-spacing:-.05em}

/* â”€â”€ TIMER â”€â”€ */
#timer-wrap{width:min(380px,82vw);height:5px;background:var(--surface);
  border-radius:3px;margin-bottom:3.5rem;position:relative;overflow:visible}
#timer-bar{height:100%;width:100%;border-radius:3px;transition:width 1s linear,background .4s}
#timer-wrap.pulse{animation:tpulse .45s ease infinite}

/* â”€â”€ STREAK BADGE â”€â”€ */
#combo-badge{position:absolute;top:5rem;left:50%;transform:translateX(-50%);
  font-size:.72rem;letter-spacing:.12em;padding:.25rem .8rem;border-radius:20px;
  font-weight:900;transition:opacity .3s;opacity:0;pointer-events:none}
#combo-badge.show{opacity:1}
#combo-badge.x2{background:var(--warn);color:#000}
#combo-badge.x3{background:var(--danger);color:#fff;animation:combopulse .55s ease infinite}

/* â”€â”€ WORD AREA â”€â”€ */
#word-area{min-height:7rem;display:flex;flex-direction:column;
  align-items:center;justify-content:center;margin-bottom:2rem;position:relative}
#word-letters{font-size:clamp(1.4rem,5vw,3.4rem);font-weight:900;letter-spacing:.18em;
  user-select:none;transition:opacity .15s;max-width:90vw;text-align:center;word-break:break-all;line-height:1.3}

/* â”€â”€ PER-WORD WPM FLASH â”€â”€ */
#wpm-flash{position:absolute;top:-2.8rem;left:50%;transform:translateX(-50%);
  font-size:1.6rem;font-weight:900;color:var(--accent);letter-spacing:.05em;
  pointer-events:none;opacity:0;white-space:nowrap}
#wpm-flash.pop{animation:wpmPop .9s ease-out forwards}

/* â”€â”€ INPUT â”€â”€ */
#game-input{background:none;border:none;border-bottom:2px solid #333;
  color:var(--text);font-size:1.5rem;font-family:'Courier New',monospace;
  text-align:center;width:min(360px,85vw);padding:.5rem;outline:none;
  letter-spacing:.12em;transition:border-color .2s}
#game-input:focus{border-color:var(--accent)}
.hint{margin-top:.8rem;color:var(--dim);font-size:.75rem;letter-spacing:.04em}

/* â”€â”€ LIVE WPM â”€â”€ */
#live-wpm{position:absolute;bottom:1.5rem;left:50%;transform:translateX(-50%);
  font-size:.78rem;color:var(--dim);letter-spacing:.05em;white-space:nowrap}

/* â”€â”€ TICK â”€â”€ */
#tick-el{font-size:3.2rem;display:none}

/* â”€â”€ SPEAKING INDICATOR â”€â”€ */
#speaking-dot{width:8px;height:8px;border-radius:50%;background:var(--accent);
  display:inline-block;margin-left:.4rem;opacity:0;transition:opacity .2s;animation:speakpulse .6s ease infinite}
#speaking-dot.active{opacity:1}

/* â”€â”€ ELIMINATED BANNER â”€â”€ */
#elim-banner{position:fixed;inset:0;background:rgba(0,0,0,.78);backdrop-filter:blur(8px);
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  z-index:200;opacity:0;pointer-events:none;transition:opacity .3s}
#elim-banner.show{opacity:1;pointer-events:all}
#elim-word{font-size:.85rem;color:var(--dim);margin-bottom:.5rem;letter-spacing:.08em}
#elim-msg{font-size:2.2rem;font-weight:900;color:var(--danger);letter-spacing:.12em;margin-bottom:.3rem}
#elim-correct{font-size:1.1rem;color:var(--correct);margin-bottom:2rem;letter-spacing:.05em}

/* â”€â”€ KEYBOARD â”€â”€ */
#keyboard{margin-top:1.8rem;display:flex;flex-direction:column;align-items:center;gap:5px}
.kb-row{display:flex;gap:5px}
.key{width:clamp(22px,3.2vw,34px);height:clamp(22px,3.2vw,34px);background:var(--key-bg);
  color:var(--key-text);border-radius:4px;display:flex;align-items:center;
  justify-content:center;font-size:clamp(.42rem,.7vw,.62rem);border:1px solid #2e2e2e;
  transition:background .1s,color .1s,transform .08s}
.key.ok{background:var(--correct)!important;color:#000!important;transform:scale(1.18)}
.key.err{background:var(--danger)!important;color:#fff!important}

/* â”€â”€ COUNTDOWN â”€â”€ */
#countdown{position:fixed;inset:0;background:var(--bg);display:flex;flex-direction:column;
  align-items:center;justify-content:center;z-index:100}
#cdown-num{font-size:6rem;font-weight:900;color:var(--accent)}

/* â”€â”€ PARTICLES â”€â”€ */
.pt{position:fixed;width:7px;height:7px;border-radius:50%;pointer-events:none;
  z-index:150;animation:burst .65s ease-out forwards}

/* â”€â”€ SCORE POP â”€â”€ */
.score-pop{position:fixed;font-size:1.3rem;font-weight:900;pointer-events:none;
  z-index:300;animation:scorefloat .8s ease-out forwards}

/* â”€â”€ STAT GRID â”€â”€ */
.stat-grid{display:grid;grid-template-columns:1fr 1fr;gap:.8rem;margin:1.4rem 0;width:min(340px,85vw)}
.stat-box{background:var(--surface);padding:1rem;text-align:center;border-radius:6px}
.stat-val{font-size:1.6rem;font-weight:900;color:var(--accent)}
.stat-lbl{font-size:.68rem;color:var(--dim);margin-top:.3rem;letter-spacing:.06em;text-transform:uppercase}

/* â”€â”€ ANIMATIONS â”€â”€ */
@keyframes shake{0%,100%{transform:translateX(0)}20%{transform:translateX(-9px)}40%{transform:translateX(9px)}60%{transform:translateX(-6px)}80%{transform:translateX(6px)}}
@keyframes pop{0%{transform:scale(.4);opacity:0}60%{transform:scale(1.35)}100%{transform:scale(1);opacity:1}}
@keyframes burst{0%{transform:translate(0,0);opacity:1}100%{transform:translate(var(--dx),var(--dy));opacity:0}}
@keyframes cdown{0%{transform:scale(1.7);opacity:0}20%{transform:scale(1);opacity:1}80%{transform:scale(1);opacity:1}100%{transform:scale(.4);opacity:0}}
@keyframes tpulse{0%,100%{opacity:1}50%{opacity:.2}}
@keyframes combopulse{0%,100%{transform:translateX(-50%) scale(1)}50%{transform:translateX(-50%) scale(1.1)}}
@keyframes scorefloat{0%{transform:translateY(0);opacity:1}100%{transform:translateY(-65px);opacity:0}}
@keyframes wpmPop{0%{opacity:1;transform:translateX(-50%) translateY(0) scale(1.3)}60%{opacity:1;transform:translateX(-50%) translateY(-8px) scale(1)}100%{opacity:0;transform:translateX(-50%) translateY(-20px) scale(.9)}}
@keyframes bossentry{0%{letter-spacing:.04em;opacity:0}100%{letter-spacing:.18em;opacity:1}}
@keyframes speakpulse{0%,100%{transform:scale(1)}50%{transform:scale(1.5)}}
.boss-word{animation:bossentry .35s ease forwards}
@media(max-width:600px){#keyboard{display:none}}
</style>
</head>
<body>

<div id="countdown" class="hidden">
  <div id="cdown-num"></div>
  <div style="font-size:.95rem;color:var(--dim);margin-top:1rem;letter-spacing:.25em">GET READY</div>
</div>

<!-- ELIMINATED BANNER -->
<div id="elim-banner">
  <div id="elim-word"></div>
  <div id="elim-msg">âŒ ELIMINATED</div>
  <div id="elim-correct"></div>
</div>

<!-- MENU -->
<div id="screen-menu" class="screen">
  <div id="logo">TYPEFAST</div>
  <div id="tagline">think fast Â· type faster</div>
  <div id="menu-hs"></div>
  <div id="voice-toggle">
    <input type="checkbox" id="voice-cb" checked/>
    <label for="voice-cb">ğŸ”Š ANNOUNCER VOICE</label>
    <span id="speaking-dot"></span>
  </div>
  <button class="btn-main" onclick="runCountdown()">â–¶ PLAY</button>
  <div class="menu-info">
    auto-submits on correct Â· <kbd style="color:var(--text)">Enter</kbd> to submit manually<br>
    wrong answer = <span style="color:var(--danger)">eliminated</span> Â· 5+ streak = 2Ã— Â· 10+ = 3Ã—<br>
    streak grows â†’ timer shrinks Â· every 10th word is a boss ğŸ’€
  </div>
</div>

<!-- GAME -->
<div id="screen-game" class="screen hidden">
  <div class="hdr">
    <div>score <span class="hv" id="hdr-score">0</span></div>
    <div id="hdr-wpm-strip" style="color:var(--accent);font-weight:900;font-size:.88rem">â€” WPM</div>
    <div id="hdr-streak-wrap">streak <span class="hv" id="hdr-streak">0</span><span id="fire-icons"></span></div>
  </div>

  <div id="combo-badge">2Ã— COMBO</div>
  <div id="timer-wrap"><div id="timer-bar"></div></div>

  <div id="word-area">
    <div id="wpm-flash"></div>
    <div id="boss-label" style="font-size:.65rem;letter-spacing:.2em;color:var(--danger);margin-bottom:.5rem;opacity:0;transition:opacity .3s">ğŸ’€ BOSS WORD</div>
    <div id="word-letters"></div>
    <div id="tick-el">âœ…</div>
  </div>

  <input id="game-input" type="text" placeholder="type hereâ€¦"
         autocomplete="off" autocorrect="off" spellcheck="false"
         oninput="onInput()" onkeydown="onKey(event)"/>
  <div class="hint">auto-submits when correct Â· Enter to submit (wrong = eliminated)</div>
  <div id="keyboard"></div>
  <div id="live-wpm"></div>
</div>

<!-- GAME OVER -->
<div id="screen-over" class="screen hidden">
  <div style="font-size:1.4rem;color:var(--danger);margin-bottom:.4rem;letter-spacing:.12em;font-weight:900">ELIMINATED</div>
  <div style="font-size:.82rem;color:var(--dim);margin-bottom:.8rem" id="over-word-label"></div>
  <div style="font-size:4.5rem;font-weight:900;color:var(--accent)" id="over-score">0</div>
  <div style="color:var(--dim);margin-bottom:.4rem;font-size:.85rem">POINTS</div>
  <div id="over-hs" style="color:var(--accent);font-size:.88rem;min-height:1.3rem;margin-bottom:.8rem"></div>
  <div class="stat-grid">
    <div class="stat-box"><div class="stat-val" id="st-best-wpm">â€”</div><div class="stat-lbl">Best WPM</div></div>
    <div class="stat-box"><div class="stat-val" id="st-avg-wpm">â€”</div><div class="stat-lbl">Avg WPM</div></div>
    <div class="stat-box"><div class="stat-val" id="st-acc">â€”</div><div class="stat-lbl">Accuracy</div></div>
    <div class="stat-box"><div class="stat-val" id="st-streak">0</div><div class="stat-lbl">Best Streak</div></div>
  </div>
  <button class="btn-main" onclick="runCountdown()">PLAY AGAIN</button>
  <button class="btn-sub" onclick="showMenu()">menu</button>
</div>

<script>
// â”€â”€ WORD LISTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const W={
  easy:[
    "cat","dog","run","big","sun","hat","red","cup","leg","map",
    "box","pen","far","win","hot","old","new","ice","air","sky",
    "sea","job","fun","key","bag","arm","ear","eye","lip","rib",
    "ant","bat","cab","dam","eel","fan","gem","hen","ink","jar",
    "keg","log","mud","net","oak","paw","rat","sap","tin","web",
    "yak","zoo","arc","dew","fog","gut","hip","ivy","jot","kit",
    "lap","mob","nap","ore","pod","rug","sob","tan","urn","van",
    "wax","yew","zip","axe","bay","cog","den","elm","foe","gap"
  ],
  med:[
    "apple","brave","chess","drive","eagle","flame","grace","happy","image","joker",
    "kneel","lemon","magic","night","ocean","piano","queen","river","stone","tiger",
    "under","voice","water","youth","zebra","blaze","cloud","dance","earth","frost",
    "giant","handy","inlet","jewel","karma","latch","manor","nerve","orbit","plaid",
    "query","ridge","scone","trout","usher","venom","waltz","xenon","yacht","zonal",
    "abbey","brine","crisp","duchy","ember","flint","graft","heron","irony","joust",
    "knack","lyric","marsh","nymph","oxide","pluck","quirk","realm","shrub","taunt",
    "ulcer","vivid","wrist","xylem","yearn","zesty","brisk","cleft","dross","expel"
  ],
  hard:[
    "balloon","cabinet","diamond","elegant","fashion","granite","harmony","inspire","jumping","kitchen",
    "landing","morning","natural","opening","painted","quantum","rapidly","silence","theater","uniform",
    "vibrant","weather","younger","ancient","balance","captain","dolphin","emperor","factory","gesture",
    "highway","illness","jasmine","kinship","lantern","mineral","network","obvious","pilgrim","quarter",
    "reserve","station","texture","upriver","village","warrior","xeriscape","yellowed","zealous","abstain",
    "bracket","cobweb","discord","earnest","ferment","genuine","harmful","impeach","journey","kingdom",
    "leisure","mandate","nominal","outpost","pyramid","quintet","rampart","sinuous","tradesman","upright",
    "vagrant","wampum","xiphoid","yardarm","zonally","abscond","barrack","clarify","durable","eclipse"
  ],
  exp:[
    "accomplish","beautiful","celebrate","determine","elaborate","furniture","glamorous","highlight","important","journalist",
    "knowledge","landscape","narrative","obsession","recognize","structure","temporary","universal","vulnerable","wonderful",
    "extremely","breathing","certainly","chocolate","different","establish","fantastic","gorgeous","honorable","invisible",
    "justifiable","kilometer","luxurious","mythology","nourished","operation","perpetual","quotation","ridiculous","sanctuary",
    "terrifying","unanimous","variation","weathering","yesterday","zealously","abnormally","carefully","diligence","efficient",
    "flourished","gracefully","hindsight","incognito","juxtapose","kinesthetic","labyrinth","medallion","nefarious","obscurely",
    "plagiarism","qualified","rebellious","systematic","tenacious","unbearable","vigilance","wholesome","xenophile","youthfully",
    "cacophony","deficiency","embroiled","fictitious","guillotine","hyperbole","indelible","jackhammer","kleptomaniac","lunatics"
  ],
  boss:[
    "incomprehensible","uncomfortable","revolutionary","acknowledgement","straightforward",
    "responsibility","circumstances","accomplishment","approximately","communication",
    "encouragement","extraordinary","qualification","unfortunately","administration",
    "comprehension","disappointment","establishment","opportunities","specification",
    "antidisestablishmentarianism","pneumonoultramicroscopicsilicovolcanoconiosis",
    "floccinaucinihilipilification","supercalifragilisticexpialidocious",
    "hippopotomonstrosesquippedaliophobia","pseudopseudohypoparathyroidism",
    "electroencephalographically","otorhinolaryngological","immunoelectrophoretically",
    "chargoggagoggmanchauggagoggchaubunagungamaugg",
    "dichlorodifluoromethane","psychophysicotherapeutics","thyroparathyroidectomized",
    "spectrophotofluorometrically","hepaticocholangiocholecystenterostomies"
  ]
};

// â”€â”€ VOICE / TTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let voiceEnabled = true;
let isFirstWordThisGame = true;
let speakTimeout = null;
let currentUtterance = null;

document.getElementById('voice-cb').addEventListener('change', function(){
  voiceEnabled = this.checked;
  if(!voiceEnabled) stopSpeech();
});

function stopSpeech(){
  speechSynthesis.cancel();
  currentUtterance = null;
  setSpeakingDot(false);
  clearTimeout(speakTimeout);
}

function setSpeakingDot(on){
  const dot = document.getElementById('speaking-dot');
  dot.classList.toggle('active', on);
}

function pickVoice(){
  const voices = speechSynthesis.getVoices();
  // Prefer a natural English voice â€” Google US English, Samantha, Daniel, Alex
  const preferred = ['Google US English','Samantha','Alex','Daniel','Karen','Moira','Fiona'];
  for(const name of preferred){
    const v = voices.find(v => v.name === name);
    if(v) return v;
  }
  // Fallback: any en-US
  return voices.find(v => v.lang === 'en-US') ||
         voices.find(v => v.lang.startsWith('en')) ||
         voices[0] || null;
}

function speakWord(w){
  if(!voiceEnabled) return;
  stopSpeech();

  const phrase = isFirstWordThisGame
    ? `Spell the word. ${w}`
    : `Alright, spell the word. ${w}`;
  isFirstWordThisGame = false;

  // Small delay so the UI renders first
  speakTimeout = setTimeout(()=>{
    const utter = new SpeechSynthesisUtterance(phrase);
    utter.rate  = 0.88;
    utter.pitch = 1.05;
    utter.volume = 1;
    const v = pickVoice();
    if(v) utter.voice = v;
    utter.onstart = () => setSpeakingDot(true);
    utter.onend   = () => setSpeakingDot(false);
    utter.onerror = () => setSpeakingDot(false);
    currentUtterance = utter;
    speechSynthesis.speak(utter);
  }, 80);
}

// Pre-load voices (Chrome needs this)
if(typeof speechSynthesis !== 'undefined'){
  speechSynthesis.getVoices();
  speechSynthesis.onvoiceschanged = () => speechSynthesis.getVoices();
}

// â”€â”€ KEYBOARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const ROWS=[['Q','W','E','R','T','Y','U','I','O','P'],['A','S','D','F','G','H','J','K','L'],['Z','X','C','V','B','N','M']];
(function(){
  const kb=document.getElementById('keyboard');
  ROWS.forEach(row=>{const r=document.createElement('div');r.className='kb-row';row.forEach(k=>{const el=document.createElement('div');el.className='key';el.textContent=k;el.id='k'+k;r.appendChild(el);});kb.appendChild(r);});
})();
function flashKey(ch,ok){const el=document.getElementById('k'+ch.toUpperCase());if(!el)return;el.classList.add(ok?'ok':'err');setTimeout(()=>el.classList.remove('ok','err'),260);}

// â”€â”€ STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let score=0,streak=0,bestStreak=0,wordsTyped=0,hs=0;
let word='',used=[],usedBoss=[],maxT=10,tim=null,ticking=false,isBoss=false;
let gStart=0,totChars=0,keysTotal=0,keysCorrect=0,wStart=0,lastLen=0;
let bossBeaten=0,wordWpmList=[],lastWordWpm=0,eliminatedWord='';

function getMultiplier(){return streak>=10?3:streak>=5?2:1;}
function pool(s){return s<5?W.easy:s<12?W.med:s<22?W.hard:W.exp;}

function timeFor(s,w,boss){
  if(boss) return Math.max(6, Math.ceil(w.length * 0.65));
  const base = Math.max(10 - Math.floor(s/4), 4);
  const sp   = Math.min(Math.floor(streak/3), 4);
  return Math.max(base - sp + Math.ceil(w.length/5), 3);
}

function pickWord(s,boss){
  if(boss){let w,a=0;do{w=W.boss[Math.floor(Math.random()*W.boss.length)];a++;}while(usedBoss.includes(w)&&a<10);return w;}
  const p=pool(s);let w,a=0;do{w=p[Math.floor(Math.random()*p.length)];a++;}while(used.includes(w)&&a<20);return w;
}

function $id(i){return document.getElementById(i);}
function show(id){$id(id).classList.remove('hidden');}
function hide(id){$id(id).classList.add('hidden');}
function showMenu(){
  stopSpeech();
  hide('screen-game');hide('screen-over');show('screen-menu');
  $id('menu-hs').textContent=hs>0?'ğŸ† Best: '+hs+' pts':'';
}

// â”€â”€ COUNTDOWN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function runCountdown(){
  stopSpeech();
  hide('screen-menu');hide('screen-over');hide('screen-game');
  $id('elim-banner').classList.remove('show');
  const cd=$id('countdown'),num=$id('cdown-num');
  cd.classList.remove('hidden');
  const steps=['3','2','1','GO!'];let i=0;
  (function step(){
    num.textContent=steps[i];num.style.animation='none';void num.offsetWidth;num.style.animation='cdown 1s ease forwards';i++;
    if(i<steps.length)setTimeout(step,900);
    else setTimeout(()=>{cd.classList.add('hidden');startGame();},700);
  })();
}

// â”€â”€ GAME â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function startGame(){
  score=0;streak=0;bestStreak=0;wordsTyped=0;used=[];usedBoss=[];
  totChars=0;keysTotal=0;keysCorrect=0;wordWpmList=[];lastLen=0;bossBeaten=0;
  ticking=false;isBoss=false;eliminatedWord='';lastWordWpm=0;
  isFirstWordThisGame = true;
  show('screen-game');updateHdr();updateCombo();updateFire();
  setNextWord(0,false);
  gStart=Date.now();wStart=Date.now();
  setTimeout(()=>$id('game-input').focus(),60);
}

function setNextWord(s,boss){
  isBoss=boss;
  word=pickWord(s,boss);
  if(boss)usedBoss.push(word);else used.push(word);
  const t=timeFor(s,word,boss);maxT=t;
  resetInp();renderWord();startTimer(t);
  $id('boss-label').style.opacity=boss?'1':'0';
  speakWord(word);
  wStart=Date.now();
}

function renderWord(){
  const v=$id('game-input').value;
  const boss=isBoss;
  $id('word-letters').innerHTML=word.split('').map((ch,i)=>{
    const tp=v[i];
    const c=!tp?(boss?'var(--danger)':'var(--text)'):tp.toLowerCase()===ch.toLowerCase()?'var(--correct)':'var(--danger)';
    return `<span style="color:${c};transition:color .08s">${ch.toUpperCase()}</span>`;
  }).join('');
  if(v.length>0){
    const elapsed=(Date.now()-wStart)/60000;
    const live=Math.round((v.length/5)/elapsed);
    $id('live-wpm').textContent=live+' WPM  Â·  typing now';
  } else {
    $id('live-wpm').textContent='';
  }
}

function resetInp(){
  const el=$id('game-input');
  el.value='';el.style.opacity='1';el.disabled=false;
  lastLen=0;
  $id('timer-wrap').classList.remove('pulse');
  $id('live-wpm').textContent='';
}

function startTimer(t){
  clearInterval(tim);let left=t;updateBar(left,t);
  tim=setInterval(()=>{
    left--;updateBar(left,maxT);
    if(left<=3&&left>0)$id('timer-wrap').classList.add('pulse');
    else if(left>3)$id('timer-wrap').classList.remove('pulse');
    if(left<=0){clearInterval(tim);eliminatedWord='';endGame('time');}
  },1000);
}

function updateBar(l,m){
  const p=l/m,bar=$id('timer-bar');
  bar.style.width=(p*100)+'%';
  bar.style.background=p>.5?'var(--correct)':p>.25?'var(--warn)':'var(--danger)';
}

function updateHdr(){
  $id('hdr-score').textContent=score;
  const s=$id('hdr-streak');s.textContent=streak;
  s.style.color=streak>=5?'var(--accent)':streak>=3?'var(--correct)':'var(--text)';
  $id('hdr-wpm-strip').textContent=lastWordWpm>0?lastWordWpm+' WPM':'â€” WPM';
}

function updateFire(){
  const f=streak>=10?'ğŸ”¥ğŸ”¥ğŸ”¥':streak>=7?'ğŸ”¥ğŸ”¥':streak>=5?'ğŸ”¥':'';
  $id('fire-icons').textContent=f?' '+f:'';
}

function updateCombo(){
  const m=getMultiplier(),b=$id('combo-badge');
  if(m>1){b.className='combo-badge show x'+m;b.textContent=m+'Ã— COMBO';}
  else{b.className='combo-badge';}
}

function flashWpm(wpm){
  const el=$id('wpm-flash');
  el.textContent=wpm+' WPM';
  el.classList.remove('pop');
  void el.offsetWidth;
  el.classList.add('pop');
}

// â”€â”€ INPUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function onInput(){
  if(ticking)return;
  const el=$id('game-input'),v=el.value;
  if(v.length>lastLen){
    const ch=v[v.length-1],ex=word[v.length-1];
    const ok=ch&&ex&&ch.toLowerCase()===ex.toLowerCase();
    flashKey(ch,ok);
    keysTotal+=(v.length-lastLen);
  }
  lastLen=v.length;
  renderWord();
  if(v.toLowerCase()===word.toLowerCase()) submitCorrect();
}

function onKey(e){
  if(ticking)return;
  if(e.key==='Enter'){
    const v=$id('game-input').value.trim();
    if(!v)return;
    if(v.toLowerCase()===word.toLowerCase()){
      submitCorrect();
    } else {
      eliminatedWord=v;
      clearInterval(tim);
      $id('timer-wrap').classList.remove('pulse');
      endGame('wrong');
    }
  }
}

function submitCorrect(){
  clearInterval(tim);$id('timer-wrap').classList.remove('pulse');
  stopSpeech();

  const ms=Date.now()-wStart;
  const wordWpm=Math.round((word.length/5)/(ms/60000));
  lastWordWpm=wordWpm;
  wordWpmList.push(wordWpm);

  keysCorrect+=word.length;
  totChars+=word.length;
  const mult=getMultiplier();
  score+=mult;streak++;wordsTyped++;
  if(streak>bestStreak)bestStreak=streak;
  if(isBoss)bossBeaten++;
  if(score>hs)hs=score;

  flashWpm(wordWpm);
  showScorePop(mult);
  updateHdr();updateCombo();updateFire();
  doBurst();

  ticking=true;
  const el=$id('game-input');
  el.disabled=true;el.style.opacity='0';
  $id('word-letters').style.visibility='hidden';
  const tk=$id('tick-el');tk.style.display='block';tk.style.animation='none';void tk.offsetWidth;tk.style.animation='pop .38s ease';

  setTimeout(()=>{
    tk.style.display='none';$id('word-letters').style.visibility='visible';
    ticking=false;
    const nextBoss=wordsTyped>0&&wordsTyped%10===0;
    setNextWord(score,nextBoss);
    setTimeout(()=>$id('game-input').focus(),30);
  },480);
}

function showScorePop(mult){
  if(mult<=1)return;
  const r=$id('word-area').getBoundingClientRect();
  const el=document.createElement('div');el.className='score-pop';
  el.style.cssText=`left:${r.right+6}px;top:${r.top+10}px;color:${mult>=3?'var(--danger)':'var(--warn)'}`;
  el.textContent='+'+mult;document.body.appendChild(el);setTimeout(()=>el.remove(),850);
}

function doBurst(){
  const r=$id('word-area').getBoundingClientRect();
  const cx=r.left+r.width/2,cy=r.top+r.height/2;
  const cols=['var(--accent)','var(--correct)','var(--accent2)'];
  for(let i=0;i<16;i++){
    const p=document.createElement('div');p.className='pt';
    const a=(i/16)*360,d=45+Math.random()*50;
    const dx=Math.cos(a*Math.PI/180)*d,dy=Math.sin(a*Math.PI/180)*d;
    p.style.cssText=`left:${cx}px;top:${cy}px;background:${cols[i%3]};--dx:${dx}px;--dy:${dy}px`;
    document.body.appendChild(p);setTimeout(()=>p.remove(),660);
  }
}

// â”€â”€ GAME OVER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function endGame(reason){
  stopSpeech();
  if(reason==='wrong'){
    $id('elim-msg').textContent='âŒ ELIMINATED';
    $id('elim-word').textContent='you typed: "'+eliminatedWord+'"';
    $id('elim-correct').textContent='correct: '+word.toUpperCase();
  } else {
    $id('elim-msg').textContent="â± TIME'S UP";
    $id('elim-word').textContent='the word was: '+word.toUpperCase();
    $id('elim-correct').textContent='';
  }
  $id('elim-banner').classList.add('show');
  setTimeout(()=>{$id('elim-banner').classList.remove('show');showOver();},1600);
}

function showOver(){
  hide('screen-game');show('screen-over');
  $id('over-score').textContent=score;
  $id('over-word-label').textContent=wordsTyped+' word'+(wordsTyped!==1?'s':'')+' typed';
  $id('over-hs').textContent=score>0&&score>=hs?'ğŸ† New High Score!':hs>0?'Best: '+hs+' pts':'';

  const best=wordWpmList.length?Math.max(...wordWpmList):0;
  const avg=wordWpmList.length?Math.round(wordWpmList.reduce((a,b)=>a+b,0)/wordWpmList.length):0;
  $id('st-best-wpm').textContent=best||'â€”';
  $id('st-avg-wpm').textContent=avg||'â€”';
  $id('st-acc').textContent=keysTotal>0?Math.round(keysCorrect/keysTotal*100)+'%':'â€”';
  $id('st-streak').textContent=bestStreak;
}
</script>
</body>
</html>
